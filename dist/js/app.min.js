function doSearch(e){var o="https://www.googleapis.com/books/v1/volumes?langRestrict=pt&maxResults=20&filter=ebooks&orderBy=relevance&q="+e,a=$("#searchResult"),s=$(".form-control");s.addClass("loading"),$.ajax({type:"GET",contentType:"application/json; charset=utf-8",dataType:"json",url:o,success:function(o){s.removeClass("loading"),0==o.totalItems?a.empty().append('<div class="searchInfo">Ops, infelizmente sua busca por <span>'+e+"</span> não obteve resultados! Tente fazer uma nova busca com outro termo =)</div>"):(a.empty().append('<div class="searchInfo">Sua busca por <span>'+e+"</span> retornou <span>"+o.items.length+"</span> livro(s):</div>"),$.each(o.items,function(e,o){myBooks=null==JSON.parse(localStorage.getItem("myBooks"))?myBooks=[]:JSON.parse(localStorage.getItem("myBooks"));var s=o.id;if(s==myBooks.filter(function(e){return e===s}))var t="fa-heart";else var t="fa-heart-o";var l=o.volumeInfo.title,r=o.volumeInfo.imageLinks?o.volumeInfo.imageLinks.smallThumbnail:"",i=o.volumeInfo.authors,n=o.searchInfo?o.searchInfo.textSnippet:"Descrição não disponível",d=o.volumeInfo.pageCount?o.volumeInfo.pageCount:"N/D",c=o.saleInfo.retailPrice?o.saleInfo.retailPrice.amount.toString().replace(".",","):"N/D",m=o.accessInfo.webReaderLink.replace("http://","https://"),v='<div class="book"><div class="myFav"><a onclick="bookFav(\''+s+'\')"><i class="fa '+t+'" aria-hidden="true"></i></a></div><div class="row no-gutters"><div class="col-3 col-md-2"><img class="img-fluid img-thumbnail" src="'+r+'"></div><div class="col"><h3>'+l+'</h3><span class="text-muted">Por: '+i+"</span><br><p>"+n+'</p></div></div><div class="row no-gutters text-center"><div class="col"><strong>R$ '+c+'</strong></div><div class="col">Páginas: '+d+'</div><div class="col"><a href="#1" onclick="openPreview(\''+l+"', '"+m+"')\">Preview</a></div></div></div>";a.append(v).fadeIn()}))},error:function(e,o,t){console.log(e),console.log(o),console.log(t),s.removeClass("loading"),a.empty().append('<div class="alert alert-warning text-center" role="alert">Oh snap! Ocorreu algum erro ao requisitar dados ao Google. Tente novamente!</div>').fadeIn()}})}function openPreview(e,o){console.log(e,o);var a='<div class="modal fade" id="bookPreview" tabindex="-1" role="dialog" aria-labelledby="bookPreviewLabel" aria-hidden="true"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="bookPreviewLabel">'+e+'</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"><iframe src="'+o+'&output=embed" frameborder="0"></iframe></div></div></div></div>';$("body").prepend(a),$("#bookPreview").modal("show"),$("#bookPreview").on("hidden.bs.modal",function(e){$("#bookPreview").remove()})}function bookFav(e){e!=myBooks.filter(function(o){return o===e})?(myBooks.push(e),localStorage.setItem("myBooks",JSON.stringify(myBooks)),$(event.target).removeClass("fa-heart-o").addClass("fa-heart")):(myBooks=myBooks.filter(function(o){return o!==e}),localStorage.setItem("myBooks",JSON.stringify(myBooks)),$(event.target).removeClass("fa-heart").addClass("fa-heart-o")),console.log(JSON.parse(localStorage.getItem("myBooks")))}$("#searchTerm").keypress(function(e){13==e.which&&""!=$(this).val()&&(doSearch($(this).val()),$(this).blur())});